- name: Create a db on MSSQL
  hosts: all
  gather_facts: no

  tasks:
    - name: Enable port for MSSQL
      win_firewall_rule:
        name: MSSQL
        localport: 1433
        action: allow
        direction: in
        protocol: tcp
        profiles: public
        state: present
        enabled: yes

    - name: Create a db
      mssql_db:
        login_host: "{{ ansible_ssh_host | default(inventory_hostname) }}"
        login_user: sa
        login_password: Password1!
        name: redhatdemo
        state: present
      delegate_to: 127.0.0.1