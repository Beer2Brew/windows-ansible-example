---

- debug:
    var: hostvars[inventory_hostname]

- name: Create an incident
  snow_record:
    state: present
    table: cmdb_ci_win_server
    username: "{{ sn_username }}"
    password: "{{ sn_password }}"
    instance: "{{ sn_instance }}"
    data:
      name: "{{ inventory_hostname }}"
      host_name: "{{ ansible_hostname }}"
      ip_address: "{{ hostvars[inventory_hostname].ansible_default_ipv4.address }}"
      mac_address: "{{ hostvars[inventory_hostname].ansible_default_ipv4.macaddress }}"
      os: windows
  delegate_to: localhost
  vars:
    ansible_connection: local
  register: new_host

- debug:
    var: new_host
